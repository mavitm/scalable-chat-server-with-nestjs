(function(e){function t(t){for(var n,r,a=t[0],c=t[1],l=t[2],d=0,m=[];d<a.length;d++)r=a[d],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&m.push(o[r][0]),o[r]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);u&&u(t);while(m.length)m.shift()();return i.push.apply(i,l||[]),s()}function s(){for(var e,t=0;t<i.length;t++){for(var s=i[t],n=!0,a=1;a<s.length;a++){var c=s[a];0!==o[c]&&(n=!1)}n&&(i.splice(t--,1),e=r(r.s=s[0]))}return e}var n={},o={app:0},i=[];function r(t){if(n[t])return n[t].exports;var s=n[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=n,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(s,n,function(t){return e[t]}.bind(null,n));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var l=0;l<a.length;l++)t(a[l]);var u=c;i.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"05a8":function(e,t,s){"use strict";s("e51d")},1:function(e,t){},"3c41":function(e,t,s){},"56d7":function(e,t,s){"use strict";s.r(t);var n=s("3835"),o=(s("e260"),s("e6cf"),s("cca6"),s("a79d"),s("d3b7"),s("159b"),s("4fad"),s("4de4"),s("2b0e")),i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[e.$root.isLogin?s("chat-main"):s("login-form")],1)},r=[],a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app-main"}},[s("div",{staticClass:"user-info"},[s("h1",[s("span",[e._v("Hi!")]),e._v(" "+e._s(e.$root.userInfo.name))])]),s("div",{staticClass:"c-row"},[s("div",{staticClass:"col-messages"},[s("message-list")],1),s("div",{staticClass:"col-userlist"},[s("user-list")],1)]),s("message-form")],1)},c=[],l=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"message-list"},[s("div",{staticClass:"message-scroll"},e._l(e.messages,(function(e,t){return s("message-item",{key:"message-item_"+t,attrs:{message:e}})})),1)])},u=[],d=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"message-item",class:e.itemCss},[e.isNotfy?e._e():s("p",{staticClass:"item-owner"},[s("strong",[e._v(e._s(e.message.owner))])]),s("p",{staticClass:"item-content"},[e._v(e._s(e.message.content))]),e.isNotfy?e._e():s("p",{staticClass:"item-date"},[s("small",[e._v(e._s(e.message.created))])])])},m=[],p={name:"MessageItem",props:{message:{type:Object,required:!0}},computed:{itemCss:function(){var e={};return this.message.self&&(e["self-message"]=!0),this.isNotfy&&(e["notify"]=!0),e},isNotfy:function(){return Object.prototype.hasOwnProperty.call(this.message,"notify")}}},f=p,h=(s("eef0"),s("2877")),g=Object(h["a"])(f,d,m,!1,null,null,null),v=g.exports,_={name:"MessageList",components:{MessageItem:v},data:function(){return{messagePage:1,dataItemLimit:50}},computed:{messages:function(){return this.$root.messageList}},methods:{requestGetMessages:function(){var e=this;console.log("request message list"),e.$root._send("getMessages",{method:"getMessages",params:{page:e.messagePage,limit:e.dataItemLimit,sort:"asc",sortBy:"created",token:e.$root.userInfo.token},id:"getMessages"})},listenServerMessage:function(e){var t=this;if(Object.prototype.hasOwnProperty.call(e,"error"))alert(e.error.message);else{var s=e.id.indexOf(t.$root.userInfo.id)>-1;t.$root.messageList.push({id:e.result._id,owner:e.result.owner,self:s,content:e.result.message,created:e.result.created}),t.message="",t.selfMessageCount+=1,t.setScrollPos()}},listenLastMessageList:function(e){var t=this;Object.prototype.hasOwnProperty.call(e,"error")||e.result.forEach((function(e){t.setUserMessage(e)})),t.setScrollPos()},setUserMessage:function(e){var t=this,s=e.user_id.indexOf(t.$root.userInfo.id)>-1;t.$root.messageList.push({id:e._id,owner:e.user_name,self:s,content:e.content,created:e.created}),t.selfMessageCount+=1,t.message=""},listenNotify:function(e){var t=this,s="";try{if("login"===e.result.type)s=this.$options.filters.__(":user logged into the system",{user:e.result.user});else{if("logout"!==e.result.type)return;s=this.$options.filters.__(":user logged out of the system",{user:e.result.user})}t.$root.messageList.push({user_id:"-",_id:"_",user_name:e.result.user,content:s,created:new Date,notify:!0})}catch(n){console.log(n.message,e)}t.setScrollPos()},setScrollPos:function(){setTimeout((function(){var e=document.querySelector(".message-scroll");e.scrollTop=e.scrollHeight}),400)}},mounted:function(){this.requestGetMessages(),window.appEvent.on("message",this.listenServerMessage),window.appEvent.on("getMessages",this.listenLastMessageList),window.appEvent.on("notify",this.listenNotify)},destroyed:function(){window.appEvent.removeListener("message",this.listenServerMessage),window.appEvent.removeListener("getMessages",this.listenLastMessageList),window.appEvent.removeListener("notify",this.listenNotify)}},w=_,y=(s("05a8"),Object(h["a"])(w,l,u,!1,null,null,null)),b=y.exports,k=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"message-form"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.message,expression:"message"}],staticClass:"mssage-text",attrs:{type:"text",placeholder:e._f("_")("message")},domProps:{value:e.message},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendMessage.apply(null,arguments)},input:function(t){t.target.composing||(e.message=t.target.value)}}}),s("button",{staticClass:"btn btn-msg-button",attrs:{type:"button",disabled:e.btnDisable},on:{click:e.sendMessage}},[e._v(" "+e._s(e._f("_")("send"))+" ")])])},O=[],C=(s("498a"),{name:"MessageForm",data:function(){return{message:"",selfMessageCount:0}},computed:{btnDisable:function(){return this.message.trim().length<1},makeMessageId:function(){return this.selfMessageCount+"_message_"+this.$root.userInfo.id}},methods:{sendMessage:function(){var e=this;e.message.trim().length<1?e.message="":this.$root.sendMessage({method:"message",id:this.makeMessageId,params:{message:e.message,token:this.$root.userInfo.token}}).then((function(){e.message=""}))}}}),P=C,E=(s("f756"),Object(h["a"])(P,k,O,!1,null,null,null)),T=E.exports,L=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"user_list"},[s("header",[s("ul",[s("li",{on:{click:function(t){return e.changeUserList(-1)}}},[s("a",[e._v(" « ")])]),s("li",[s("a",[e._v(e._s(e.userPage))])]),s("li",{on:{click:function(t){return e.changeUserList(1)}}},[s("a",[e._v(" » ")])])])]),s("div",{staticClass:"user-list-wrapper"},[s("div",{staticClass:"user-scroll"},e._l(e.users,(function(t,n){return s("div",{key:"user"+n},[t._id!==e.$root.userInfo.id?s("div",{staticClass:"user-item"},[s("p",[e._v(e._s(t.name))]),s("a",{on:{click:function(s){return e.addToFriends(t._id)}}},[e._v(e._s(e._f("_")("add to friends")))])]):e._e()])})),0)])])},x=[],j={name:"UserList",data:function(){return{userTab:"myFriends",userPage:1,dataItemLimit:50,users:[],userListText:""}},methods:{requestGetUsers:function(){var e=this;e.$root._send("getUsers",{method:"getUsers",params:{page:e.userPage,limit:e.dataItemLimit,token:e.$root.userInfo.token},id:"getUsers"})},listenUser:function(e){var t=this;Object.prototype.hasOwnProperty.call(e,"error")?t.userListText=t.$options.filters._("no record or not found"):t.users=e.result},changeUserList:function(e){this.userPage+=e,this.userPage<1&&(this.userPage=1),this.requestGetUsers()},addToFriends:function(e){var t=this;t.$root._send("setFriend",{method:"setFriend",id:"setFriend_"+e,params:{token:t.$root.userInfo.token,id:e}}).then((function(e){Object.prototype.hasOwnProperty.call(e,"error")?alert(e.error.message):alert(e.result.message)}))}},mounted:function(){this.requestGetUsers(),window.appEvent.on("getUsers",this.listenUser)},destroyed:function(){window.appEvent.removeListener("getUsers",this.listenUser)}},M=j,$=(s("b9c2"),Object(h["a"])(M,L,x,!1,null,null,null)),I=$.exports,S={name:"ChatMain",components:{MessageList:b,MessageForm:T,UserList:I}},U=S,F=(s("7345"),Object(h["a"])(U,a,c,!1,null,null,null)),R=F.exports,N=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("form",{attrs:{id:"login-form"}},[s("div",{staticClass:"form-inputs"},["login"===e.formType?s("h1",{staticClass:"login-header",class:e.headerCss},[e._v(" "+e._s(e._f("_")("LOGIN FORM"))+" ")]):e._e(),"register"===e.formType?s("h1",{staticClass:"login-header",class:e.headerCss},[e._v(" "+e._s(e._f("_")("REGISTER FORM"))+" ")]):e._e(),e.viewForm?s("div",{staticClass:"login-main"},[e.hasError?s("p",{staticClass:"error-text"},[e._v(e._s(e.errorTextView))]):e._e(),s("div",{staticClass:"form-group"},[s("label",[e._v(e._s(e._f("_")("E-mail")))]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.email,expression:"email"}],staticClass:"form-control",attrs:{type:"text",placeholder:e._f("_")("yourname@host.ex")},domProps:{value:e.email},on:{input:function(t){t.target.composing||(e.email=t.target.value)}}})]),s("div",{staticClass:"form-group"},[s("label",[e._v(e._s(e._f("_")("Password")))]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"form-control",attrs:{type:"password",placeholder:"******",autocomplete:"off"},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}})]),"login"===e.formType?s("button",{staticClass:"btn login-button",attrs:{type:"button"},on:{click:e.connectToSocket}},[e._v(" "+e._s(e._f("_")("LOGIN"))+" ")]):e._e(),"register"===e.formType?s("div",{staticClass:"register"},[s("div",{staticClass:"form-group"},[s("label",[e._v(e._s(e._f("_")("Name")))]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"name"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:e.name},on:{input:function(t){t.target.composing||(e.name=t.target.value)}}})]),s("button",{staticClass:"btn login-button",attrs:{type:"button"},on:{click:e.connectToSocket}},[e._v(" "+e._s(e._f("_")("Register and login"))+" ")])]):e._e()]):e._e(),e.viewForm?e._e():s("div",{staticClass:"login-loader"},[s("p",{staticClass:"animated jello infinite"},[e._v("-[]-")]),s("p",{staticClass:"animated flash infinite"},[e._v(e._s(e._f("_")("Connection...")))])]),e.viewForm?s("div",{staticClass:"login-footer"},["login"===e.formType?s("span",{staticClass:"a-type",on:{click:function(t){e.formType="register"}}},[e._v(e._s(e._f("_")("Register")))]):e._e(),"register"===e.formType?s("span",{staticClass:"a-type",on:{click:function(t){e.formType="login"}}},[e._v(e._s(e._f("_")("Login")))]):e._e()]):e._e()])])},q=[],Q=s("53ca"),G=(s("a15b"),s("b0c0"),{name:"LoginForm",data:function(){return{email:"",password:"",name:"",errorText:"",errorTimer:null,viewForm:!0,formType:"login"}},computed:{hasError:function(){try{return this.errorText.length>0}catch(e){return!1}},errorTypeOfArray:function(){return"object"===Object(Q["a"])(this.errorText)},errorTextView:function(){return this.errorTypeOfArray?this.errorText.join(", "):this.errorText},headerCss:function(){var e={};return this.hasError&&(e.animated=!0,e.shakeX=!0),e}},methods:{connectToSocket:function(){this.errorText="",this.email.length<1||this.password.length<1||"register"===this.formType&&this.name.length<1?this.setError(this.$options.filters._("please fill in the fields")):(this.viewForm=!1,this.$root.socketConnected?this.socketConnectedEvent():this.$root.ws_connection())},socketConnectedEvent:function(){"login"===this.formType?this.$root.sendLoginRequest({method:"login",params:{email:this.email,password:this.password},id:"login"}):this.$root.sendRegisterRequest({method:"register",params:{email:this.email,password:this.password,name:this.name},id:"register"})},listenLogin:function(e){if(Object.prototype.hasOwnProperty.call(e,"error"))this.setError(e.error.message);else if(Object.prototype.hasOwnProperty.call(e,"result")){if(200===parseInt(e.result.code))return void this.$root.setLoginUser(e)}else this.setError(this.$options.filters._("something went wrong"))},setError:function(e){this.viewForm=!0,this.errorText=e,null!==this.errorTimer&&clearTimeout(this.errorTimer),this.errorTimer=setTimeout((function(e){e.errorText=""}),3e3,this)}},mounted:function(){window.appEvent.on("socket_connected",this.socketConnectedEvent),window.appEvent.on("login",this.listenLogin)},destroyed:function(){window.appEvent.removeListener("socket_connected",this.socketConnectedEvent),window.appEvent.removeListener("login",this.listenLogin),console.log("login cleared")}}),A=G,D=(s("5d31"),Object(h["a"])(A,N,q,!1,null,null,null)),B=D.exports,H={name:"App",components:{ChatMain:R,LoginForm:B}},J=H,z=(s("5c0b"),Object(h["a"])(J,i,r,!1,null,null,null)),V=z.exports,K=(s("b64b"),s("ac1f"),s("5319"),s("4d63"),s("c607"),s("2c3e"),s("25f0"),s("fb6a"),{_:function(e){return e},__:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=this._(e);return Object.keys(t).length>0&&Object.entries(t).forEach((function(e){var t=Object(n["a"])(e,2),o=t[0],i=t[1];s=s.replace(new RegExp(":"+o,"g"),i)})),s},capitalize:function(e){return e?(e=e.toString(),e.charAt(0).toUpperCase()+e.slice(1)):""},deCapitalize:function(e){return e?(e=e.toString(),e.charAt(0).toLowerCase()+e.slice(1)):""},dataText:function(e){return e<1024?e+" MB":e/1024+" GB"}}),X=s("8055"),W={data:function(){return{socket:null,socketConnected:!1,wsListener:{},socketPromiseQueue:{},socketPromiseTimeout:15e3,idEventPrefix:"SOCKETID_"}},methods:{ws_connection:function(){this.socketConnected||(this.socket=X.connect("ws://localhost:3000",{transports:["websocket"]}),this.socket.on("connect",this.ws_connected.bind(this)),this.socket.on("disconnect",this.ws_disconnected.bind(this)),this.socket.on("reconnect",this.ws_reconnect.bind(this)),this.socket.on("message",this.ws_dispatcher.bind(this)),this.socket.on("login",this.ws_dispatcher.bind(this)),this.socket.on("register",this.ws_dispatcher.bind(this)),this.socket.on("getUsers",this.ws_dispatcher.bind(this)),this.socket.on("setFriend",this.ws_dispatcher.bind(this)),this.socket.on("getMessages",this.ws_dispatcher.bind(this)),this.socket.on("notify",this.ws_dispatcher.bind(this)))},ws_connected:function(){console.log("socket connected"),this.socketConnected=!0,window.appEvent.emit("socket_connected")},ws_disconnected:function(){console.log("socket disconnected"),this.socketConnected=!1,window.appEvent.emit("socket_disconnected")},ws_reconnect:function(){console.log("socket reconnect")},ws_dispatcher:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"!==Object(Q["a"])(e)&&(e=JSON.parse(e)),console.log("DISPATCHER",e),Object.prototype.hasOwnProperty.call(e,"method")&&window.appEvent.emit(e.method,e),Object.prototype.hasOwnProperty.call(e,"id")&&window.appEvent.emit(this.idEventPrefix+e.id,e)},sendMessage:function(e){return this._send("message",e)},sendLoginRequest:function(e){return this._send("login",e)},sendRegisterRequest:function(e){return this._send("register",e)},_send:function(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.socket.emit(e,t),Object.prototype.hasOwnProperty.call(t,"id")?(this.socketPromiseQueue[this.idEventPrefix+t.id]=this.ws_promise(),window.appEvent.on(this.idEventPrefix+t.id,this.ws_promise_resolver),Object.prototype.hasOwnProperty.call(s,"timeout")||(s.timeout=this.socketPromiseTimeout),this.setSocketResponseTimeOut(this.idEventPrefix+t.id,s.timeout),this.socketPromiseQueue[this.idEventPrefix+t.id]):Promise.resolve(t)},ws_promise:function(){var e,t,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},n=new Promise((function(n,o){e=n,t=o;try{s(n,o)}catch(i){}}));return n.resolve=e,n.reject=t,n},ws_promise_resolver:function(e){var t="";Object.prototype.hasOwnProperty.call(e,"id")&&(t=this.idEventPrefix+e.id,Object.prototype.hasOwnProperty.call(this.socketPromiseQueue,t)&&(this.socketPromiseQueue[t].resolve(e),window.appEvent.removeListener(t,this.ws_promise_resolver),delete this.socketPromiseQueue[t]))},setSocketResponseTimeOut:function(e,t){var s=this;Object.prototype.hasOwnProperty.call(s.socketPromiseQueue,e)&&setTimeout((function(){try{window.appEvent.removeListener(e,s.ws_promise_resolver),"undefined"!==typeof s.socketPromiseQueue[e]&&s.socketPromiseQueue[e].resolve({error:{code:500,message:"client-side timeout"},id:e.replace(s.idEventPrefix,"")})}catch(t){}delete s.socketPromiseQueue[e]}),t)},ws_disconnect:function(){this.socketConnected&&this.socket.disconnect()}},created:function(){}},Y={data:function(){return{isLogin:!1,userInfo:{},messageList:[],userList:[]}},methods:{setLoginUser:function(e){this.userInfo.name=e.result.name,this.userInfo.id=e.result._id,this.userInfo.token=e.result.token,this.isLogin=!0}},mounted:function(){}},Z=s("faa1");Object.entries(K).forEach((function(e){var t=Object(n["a"])(e,2),s=t[0],i=t[1];o["a"].filter(s,i)})),o["a"].config.productionTip=!1,window.appEvent=new Z,window.App=new o["a"]({mixins:[Y,W],render:function(e){return e(V)}}).$mount("#app")},"5c0b":function(e,t,s){"use strict";s("9c0c")},"5d31":function(e,t,s){"use strict";s("6c45")},"6c45":function(e,t,s){},7345:function(e,t,s){"use strict";s("eebd")},"8fe9":function(e,t,s){},"9c0c":function(e,t,s){},b9c2:function(e,t,s){"use strict";s("edba")},e51d:function(e,t,s){},edba:function(e,t,s){},eebd:function(e,t,s){},eef0:function(e,t,s){"use strict";s("3c41")},f756:function(e,t,s){"use strict";s("8fe9")}});
//# sourceMappingURL=app.0a77853d.js.map